{% extends 'base.html.twig' %}

{% block title %}Tournois{% endblock %}

{% block main %}
    <main id="mainTournois">

        <h2> {{ isModification ? 'Modifier un tournoi' :  'Ajouter un tournoi' }}</h2>
        {{form_start(tournamentForm)}}
            {{form_widget(tournamentForm)}}
            <button>{{ isModification ? 'Modifier' :  'Ajouter'}}</button>
        {{form_end(tournamentForm)}}

     


        <h2>Tournois :</h2>
            {% for tournament in tournament %}
                <article>
                    <div>
                        <div class="main_article">
                            <h3>{{tournament.name}}</h3>
                            <p><strong>Crée le : </strong>{{tournament.date|date('d/m/y')}}</p>
                            <p><strong>Nombre de Gobelin : </strong>{{tournament.nbrParticipant}}</p>
                            <p><strong>Etat : </strong>{{tournament.etat}}</p>
                            <p><strong>Style : </strong>{{tournament.type.name}}</p>
                            <p><strong>Résultat : </strong>{{tournament.result}}</p>
                            <p><strong>Participant : </strong>
                            {% for user in tournament.user %}
                                <span>{{user.pseudo}}</span>
                            {% endfor %}</p>

                            <div class="btn_bloc">
                                <a href={{path('modify_tournaments',{'id':tournament.id})}}>modifier</a>
                                <form method="POST" onsubmit="return confirm('Confirmer la suppression?')" action="{{ path('delete_tournament',{'id': tournament.id})}}">
                                    <input type="hidden" name="_method" value="delete">
                                    <input type="hidden" name="_token" value="{{csrf_token('SUP' ~ tournament.id)}}">
                                    <button class="btn_suppr">Supprimer</button>
                                </form>
                            </div>
                            <a href="{{ path('generate_combat', {'id': tournament.id}) }}" class="btn btn-primary">Générer les Combat</a>
                        </div>

                        <img src={{asset('images/images/' ~ tournament.imageName )}} alt="image du tournoi">
                    </div>
                </article>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Round</th>
                            <th>Joueur 1</th>
                            <th>Joueur 2</th>
                            <th>Score</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if tournament.combat is not empty %}
                            {% for combat in tournament.combat %}
                                <tr>
                                    <td>{{ combat.round }}</td>
                                    <td>{{ combat.player1.pseudo }}</td>
                                    <td>{{ combat.player2.pseudo }}</td>
                                    <td>{{ combat.score ?: 'À jouer' }}</td>
                                    <td>
                                        <form action="{{ path('update_combat', {'id': combat.id}) }}" method="post">
                                            <input type="text" name="score" placeholder="Ex: 2-1">
                                            <button type="submit">Enregistrer</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4">Aucun combat à afficher</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            {% endfor %}

        


    
    </main>
{% endblock %}
